clc;
clearvars;
close all;

SUITE2P_PATH = '/home/kuhlmanlab/code/klab_Suite2P';

cfg.experiment_ID = '2069_2R_170113'; % must match filenames
cfg.sbxfiles = {...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_005.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_006.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_007.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_008.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_009.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_010.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_011.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_012.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_013.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_014.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_015.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_016.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_017.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_018.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_019.sbx',...
    '/mnt/CurrentProcessing/suite2ptesting/6plane_second/2069_2R_170113_000_020.sbx' ...
    };


% all old files will be overwritten in outpath
cfg.outpath = '/mnt/CurrentProcessing/suite2ptesting/6plane_second/processed';

cfg.do_nonridig_correction = 1;
cfg.channels = 1;
cfg.planes = 6;
cfg.do_deconvolution = 1;
cfg.image_FOV = [18,795,6,512]; % [left,right,up,down]
cfg.grating_size = [88,32]; % [left,right] in pixels AFTER cropping operation with selected FOV (interpolation to remove empty lines)
cfg.cell_diameter = 12; % in pixels!
cfg.framerate = 5.1;   % For each pixel. Approximate, for initialization of deconvolution kernel.
cfg.tempdata_folder = [];%;tempdir;
cfg.delete_raw_tiffs = 1;
cfg.write_aligned_tiffs = 0;
cfg.write_diagnostic_videos = 0; % not yet working
cfg.use_GPU = 0; %
cfg.fix_baseline = 1; % do piecewise linear detrending of aligned data and fix baselines between files (slow, can take ~2 hours)

% run suite2p using own wrapper
addpath(SUITE2P_PATH);
cfg.programpath = SUITE2P_PATH;
klab_run_suite2p(cfg);


